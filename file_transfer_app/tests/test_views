
# file_transfer_app/tests/test_views.py
import pytest
from django.contrib.auth.models import User
from django.contrib.messages import get_messages
from django.shortcuts import reverse
from django.test import Client
from file_transfer_app.models import FileTransfer

@pytest.fixture
def client():
    return Client()

@pytest.fixture
def user(db):
    return User.objects.create_user(username='testuser', password='testpassword')

@pytest.fixture
def authenticated_client(client, user):
    client.login(username='testuser', password='testpassword')
    return client

@pytest.fixture
def test_file(db, user):
    return FileTransfer.objects.create(
        title='Test File',
        uploader=user,
        file='test.txt'  # This should be a valid file path for testing
    )

def test_home_view(client):
    response = client.get(reverse('home'))
    assert response.status_code == 200
    assert 'file_transfer_app/home.html' in [template.name for template in response.templates]

def test_user_login_view_authenticated(authenticated_client):
    response = authenticated_client.get(reverse('user_login'))
    assert response.status_code == 302  # Redirects to home for authenticated user

def test_user_login_view_unauthenticated(client):
    response = client.get(reverse('user_login'))
    assert response.status_code == 200  # Should display the login page

def test_file_upload_view_authenticated(authenticated_client):
    response = authenticated_client.get(reverse('file_upload'))
    assert response.status_code == 200  # Should display the file upload page

def test_file_upload_view_unauthenticated(client):
    response = client.get(reverse('file_upload'))
    assert response.status_code == 302  # Should redirect to login page

def test_file_download_view_authenticated(authenticated_client, test_file):
    response = authenticated_client.get(reverse('file_download', args=[test_file.id]))
    assert response.status_code == 200  # Should allow file download

def test_file_download_view_unauthenticated(client, test_file):
    response = client.get(reverse('file_download', args=[test_file.id]))
    assert response.status_code == 302  # Should redirect to login page